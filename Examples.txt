FROM SPARK TO HIVE  (SPARK TARGET TABLES)
============================================
val cust = spark.read.option("header", true).option("inferSchema", true).orc("/iw/testmm/input/customer.orc")
cust.printSchema();
root
 |-- ziw_row_id: string (nullable = true)
 |-- ziw_scn: decimal(38,18) (nullable = true)
 |-- ziw_source_start_date: date (nullable = true)
 |-- ziw_source_start_timestamp: timestamp (nullable = true)
 |-- ziw_target_start_timestamp: timestamp (nullable = true)
 |-- ziw_target_start_date: date (nullable = true)
 |-- ziw_source_end_date: date (nullable = true)
 |-- ziw_source_end_timestamp: timestamp (nullable = true)
 |-- ziw_target_end_date: date (nullable = true)
 |-- ziw_target_end_timestamp: timestamp (nullable = true)
 |-- ziw_active: string (nullable = true)
 |-- ziw_is_deleted: string (nullable = true)
 |-- ziw_status_flag: string (nullable = true)
 |-- c_customer_sk: decimal(38,0) (nullable = true)
 |-- c_customer_id: string (nullable = true)
 |-- c_current_cdemo_sk: decimal(38,0) (nullable = true)
 |-- c_current_hdemo_sk: decimal(38,0) (nullable = true)
 |-- c_current_addr_sk: decimal(38,0) (nullable = true)
 |-- c_first_shipto_date_sk: decimal(38,0) (nullable = true)
 |-- c_first_sales_date_sk: decimal(38,0) (nullable = true)
 |-- c_salutation: string (nullable = true)
 |-- c_first_name: string (nullable = true)
 |-- c_last_name: string (nullable = true)
 |-- c_preferred_cust_flag: string (nullable = true)
 |-- c_birth_day: decimal(38,0) (nullable = true)
 |-- c_birth_month: decimal(38,0) (nullable = true)
 |-- c_birth_year: decimal(38,0) (nullable = true)
 |-- c_birth_country: string (nullable = true)
 |-- c_login: string (nullable = true)
 |-- c_email_address: string (nullable = true)
 |-- c_last_review_date: string (nullable = true)


                                                         ^

scala> cust.write.options(Map("path" -> "/iw/testmm/output/customer")).partitionBy("c_preferred_cust_flag").format("orc").saveAsTable("customertable")

17/10/25 13:12:34 WARN Utils: Truncated the string representation of a plan since it was too large. 
This behavior can be adjusted by setting 'spark.debug.maxToStringFields' in SparkEnv.conf.
17/10/25 13:12:36 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation
 `customertable` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive.
  Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customer

hdfs dfs -ls /iw/testmm/output/customer
Found 3 items
-rw-r--r--   3 ec2-user hdfs          0 2017-10-25 13:12 /iw/testmm/output/customer/_SUCCESS
drwxr-xr-x   - ec2-user hdfs          0 2017-10-25 13:12 /iw/testmm/output/customer/c_preferred_cust_flag=N
drwxr-xr-x   - ec2-user hdfs          0 2017-10-25 13:12 /iw/testmm/output/customer/c_preferred_cust_flag=Y


]$ hdfs dfs -ls /iw/testmm/output/customer/c_preferred_cust_flag=N
Found 1 items
-rw-r--r--   3 ec2-user hdfs       7586 2017-10-25 13:12 /iw/testmm/output/customer/c_preferred_cust_flag=N/part-r-00000-f6e47164-4d41-4a44-9db1-8a983f9427ba.snappy.orc
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
| CREATE EXTERNAL TABLE `customertable`(                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   `col` array<string> COMMENT 'from deserializer')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ROW FORMAT SERDE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| WITH SERDEPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   'path'='/iw/testmm/output/customer')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| STORED AS INPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'org.apache.hadoop.mapred.SequenceFileInputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| OUTPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|   'org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| LOCATION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   'hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable-__PLACEHOLDER__'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| TBLPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   'spark.sql.sources.provider'='orc',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'spark.sql.sources.schema.numPartCols'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|   'spark.sql.sources.schema.numParts'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   'spark.sql.sources.schema.part.0'='{\"type\":\"struct\",\"fields\":[{\"name\":\"ziw_row_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_scn\",\"type\":\"decimal(38,18)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_active\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_is_deleted\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_status_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_cdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_hdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_addr_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_shipto_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_sales_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_salutation\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_day\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_month\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_year\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_country\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_login\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_email_address\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_review_date\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_preferred_cust_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}}]}',   |
|   'spark.sql.sources.schema.partCol.0'='c_preferred_cust_flag',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   'transient_lastDdlTime'='1508937156')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-----------------------


scala> cust.write.partitionBy("c_preferred_cust_flag").format("orc").saveAsTable("customertable2")
17/10/25 13:24:24 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation `customertable2` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive. Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable2



0: jdbc:hive2://localhost:10000/default> show create table customertable2;
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              createtab_stmt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
| CREATE TABLE `customertable2`(                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   `col` array<string> COMMENT 'from deserializer')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ROW FORMAT SERDE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| WITH SERDEPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   'path'='hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable2')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| STORED AS INPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'org.apache.hadoop.mapred.SequenceFileInputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| OUTPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|   'org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| LOCATION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   'hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable2'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| TBLPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   'EXTERNAL'='FALSE',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'numFiles'='2',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|   'spark.sql.sources.provider'='orc',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'spark.sql.sources.schema.numPartCols'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|   'spark.sql.sources.schema.numParts'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   'spark.sql.sources.schema.part.0'='{\"type\":\"struct\",\"fields\":[{\"name\":\"ziw_row_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_scn\",\"type\":\"decimal(38,18)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_active\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_is_deleted\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_status_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_cdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_hdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_addr_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_shipto_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_sales_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_salutation\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_day\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_month\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_year\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_country\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_login\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_email_address\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_review_date\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_preferred_cust_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}}]}',   |
|   'spark.sql.sources.schema.partCol.0'='c_preferred_cust_flag',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   'totalSize'='14728',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   'transient_lastDdlTime'='1508937864')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
22 rows selected (0.064 seconds)

select * from customertable2;
Error: java.io.IOException: java.io.IOException: hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable2/c_preferred_cust_flag=N/part-r-00000-1e659622-f5f4-4eeb-ad8d-89d02d479485.snappy.orc not a SequenceFile (state=,code=0)
0: jdbc:hive2://localhost:10000/default> select count(*) from customertable2;
INFO  : Session is already open
INFO  : Dag name: select count(*) from customertable2(Stage-1)
INFO  :

INFO  : Status: Running (Executing on YARN cluster with App id application_1507899877053_2477)

INFO  : Map 1: -/-	Reducer 2: 0/1
INFO  : Map 1: 0/2	Reducer 2: 0/1
INFO  : Map 1: 0(+1)/2	Reducer 2: 0/1
INFO  : Map 1: 0(+2)/2	Reducer 2: 0/1
INFO  : Map 1: 0(+2,-2)/2	Reducer 2: 0/1
INFO  : Map 1: 0(+2,-4)/2	Reducer 2: 0/1
INFO  : Map 1: 0(+2,-5)/2	Reducer 2: 0/1
INFO  : Map 1: 0(+2,-6)/2	Reducer 2: 0/1
ERROR : Status: Failed
ERROR : Vertex failed, vertexName=Map 1, vertexId=vertex_1507899877053_2477_2_00, diagnostics=[Task failed, taskId=task_1507899877053_2477_2_00_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: Failure while running task:java.lang.RuntimeException: java.lang.RuntimeException: java.io.IOException: java.io.IOException: hdfs://ip-172-30-1-247.ec2.internal:8020/apps/hive/warehouse/customertable2/c_preferred_cust_flag=N/part-r-00000-1e659622-f5f4-4eeb-ad8d-89d02d479485.snappy.orc not a SequenceFile
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:173)
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.run(TezProcessor.java:139)
	at org.apache.tez.runtime.LogicalIOPr





scala> cust.write.format("orc").options(Map("path" -> "/iw/testmm/output/customertable3")).saveAsTable("customertable3")

scala>

hdfs dfs -ls /iw/testmm/output/customertable3
Found 2 items
-rw-r--r--   3 ec2-user hdfs          0 2017-10-25 13:29 /iw/testmm/output/customertable3/_SUCCESS
-rw-r--r--   3 ec2-user hdfs      10515 2017-10-25 13:29 /iw/testmm/output/customertable3/part-r-00000-0c6c46bb-07ee-49df-a73a-366bd2bbe8fd.snappy.orc
[ec2-user@dev2 orc]$

 show create table customertable3;
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              createtab_stmt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
| CREATE EXTERNAL TABLE `customertable3`(                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   `ziw_row_id` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   `ziw_scn` decimal(38,18),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   `ziw_source_start_date` date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   `ziw_source_start_timestamp` timestamp,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|   `ziw_target_start_timestamp` timestamp,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|   `ziw_target_start_date` date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   `ziw_source_end_date` date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|   `ziw_source_end_timestamp` timestamp,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   `ziw_target_end_date` date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|   `ziw_target_end_timestamp` timestamp,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   `ziw_active` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   `ziw_is_deleted` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   `ziw_status_flag` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   `c_customer_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   `c_customer_id` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|   `c_current_cdemo_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   `c_current_hdemo_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   `c_current_addr_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|   `c_first_shipto_date_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|   `c_first_sales_date_sk` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   `c_salutation` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   `c_first_name` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   `c_last_name` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   `c_preferred_cust_flag` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|   `c_birth_day` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   `c_birth_month` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   `c_birth_year` decimal(38,0),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   `c_birth_country` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   `c_login` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|   `c_email_address` string,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   `c_last_review_date` string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ROW FORMAT SERDE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   'org.apache.hadoop.hive.ql.io.orc.OrcSerde'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| WITH SERDEPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   'path'='/iw/testmm/output/customertable3')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| STORED AS INPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OUTPUTFORMAT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|   'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| LOCATION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   'hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customertable3'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| TBLPROPERTIES (                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|   'numFiles'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|   'spark.sql.sources.provider'='orc',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   'spark.sql.sources.schema.numParts'='1',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   'spark.sql.sources.schema.part.0'='{\"type\":\"struct\",\"fields\":[{\"name\":\"ziw_row_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_scn\",\"type\":\"decimal(38,18)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_start_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_source_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_date\",\"type\":\"date\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_target_end_timestamp\",\"type\":\"timestamp\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_active\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_is_deleted\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"ziw_status_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_customer_id\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_cdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_hdemo_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_current_addr_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_shipto_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_sales_date_sk\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_salutation\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_first_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_name\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_preferred_cust_flag\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_day\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_month\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_year\",\"type\":\"decimal(38,0)\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_birth_country\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_login\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_email_address\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}},{\"name\":\"c_last_review_date\",\"type\":\"string\",\"nullable\":true,\"metadata\":{}}]}',   |
|   'totalSize'='10515',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   'transient_lastDdlTime'='1508938153')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
49 rows selected (0.069 seconds)

select * from customertable3 limit 10;
+-----------------------------------+-------------------------+---------------------------------------+--------------------------------------------+--------------------------------------------+---------------------------------------+-------------------------------------+------------------------------------------+-------------------------------------+------------------------------------------+----------------------------+--------------------------------+---------------------------------+-------------------------------+-------------------------------+------------------------------------+------------------------------------+-----------------------------------+----------------------------------------+---------------------------------------+------------------------------+------------------------------+---------------------------------+---------------------------------------+-----------------------------+-------------------------------+------------------------------+---------------------------------+-------------------------+-----------------------------------------------------+------------------------------------+--+
|     customertable3.ziw_row_id     | customertable3.ziw_scn  | customertable3.ziw_source_start_date  | customertable3.ziw_source_start_timestamp  | customertable3.ziw_target_start_timestamp  | customertable3.ziw_target_start_date  | customertable3.ziw_source_end_date  | customertable3.ziw_source_end_timestamp  | customertable3.ziw_target_end_date  | customertable3.ziw_target_end_timestamp  | customertable3.ziw_active  | customertable3.ziw_is_deleted  | customertable3.ziw_status_flag  | customertable3.c_customer_sk  | customertable3.c_customer_id  | customertable3.c_current_cdemo_sk  | customertable3.c_current_hdemo_sk  | customertable3.c_current_addr_sk  | customertable3.c_first_shipto_date_sk  | customertable3.c_first_sales_date_sk  | customertable3.c_salutation  | customertable3.c_first_name  |   customertable3.c_last_name    | customertable3.c_preferred_cust_flag  | customertable3.c_birth_day  | customertable3.c_birth_month  | customertable3.c_birth_year  | customertable3.c_birth_country  | customertable3.c_login  |           customertable3.c_email_address            | customertable3.c_last_review_date  |
+-----------------------------------+-------------------------+---------------------------------------+--------------------------------------------+--------------------------------------------+---------------------------------------+-------------------------------------+------------------------------------------+-------------------------------------+------------------------------------------+----------------------------+--------------------------------+---------------------------------+-------------------------------+-------------------------------+------------------------------------+------------------------------------+-----------------------------------+----------------------------------------+---------------------------------------+------------------------------+------------------------------+---------------------------------+---------------------------------------+-----------------------------+-------------------------------+------------------------------+---------------------------------+-------------------------+-----------------------------------------------------+------------------------------------+--+
| eeb03143fd121ae32df6f0bbd270b759  | 0                       | 2017-10-13                            | 2017-10-13 06:24:57.0                      | 2017-10-13 06:24:20.0                      | 2017-10-13                            | 9999-09-09                          | 9999-09-09 09:09:09.0                    | 9999-09-09                          | 9999-09-09 09:09:09.0                    | true                       | false                          | I                               | 100000                        | AAAAAAAAAKGIBAAA              | 441077                             | 4582                               | 8487                              | 2449763
.
.
.
.

 select count(*) from customertable3;
INFO  : Session is already open
INFO  : Dag name: select count(*) from customertable3(Stage-1)
INFO  :

INFO  : Status: Running (Executing on YARN cluster with App id application_1507899877053_2477)

INFO  : Map 1: -/-	Reducer 2: 0/1
INFO  : Map 1: 0/1	Reducer 2: 0/1
INFO  : Map 1: 0(+1)/1	Reducer 2: 0/1
INFO  : Map 1: 1/1	Reducer 2: 0/1
INFO  : Map 1: 1/1	Reducer 2: 0(+1)/1
INFO  : Map 1: 1/1	Reducer 2: 1/1
+------+--+
| _c0  |
+------+--+
| 50   |
+------+--+


====================================================================================================
FROM HIVE TO Spark ( HIVE SOURCE TABLES)
============================================================================================
val fromHiveCustomer = spark.sql("select * from df_tpc_ds.customer");
fromHiveCustomer.count
res15: Long = 50
fromHiveCustomer.show()
+--------------------+-------+---------------------+--------------------------+--------------------------+---------------------+-------------------+------------------------+-------------------+------------------------+----------+--------------+---------------+-------------+----------------+------------------+------------------+-----------------+----------------------+---------------------+------------+--------------------+--------------------+---------------------+-----------+-------------+------------+-----------------+-------+--------------------+------------------+
|          ziw_row_id|ziw_scn|ziw_source_start_date|ziw_source_start_timestamp|ziw_target_start_timestamp|ziw_target_start_date|ziw_source_end_date|ziw_source_end_timestamp|ziw_target_end_date|ziw_target_end_timestamp|ziw_active|ziw_is_deleted|ziw_status_flag|c_customer_sk|   c_customer_id|c_current_cdemo_sk|c_current_hdemo_sk|c_current_addr_sk|c_first_shipto_date_sk|c_first_sales_date_sk|c_salutation|        c_first_name|         c_last_name|c_preferred_cust_flag|c_birth_day|c_birth_month|c_birth_year|  c_birth_country|c_login|     c_email_address|c_last_review_date|
+--------------------+-------+---------------------+--------------------------+--------------------------+---------------------+-------------------+------------------------+-------------------+------------------------+----------+--------------+---------------+-------------+----------------+------------------+------------------+-----------------+----------------------+---------------------+------------+--------------------+--------------------+---------------------+-----------+-------------+------------+-----------------+-------+--------------------+------------------+
|eeb03143fd121ae32...|  0E-18|           2017-10-13|      2017-10-13 06:24:...|      2017-10-13 06:24:...|           2017-10-13|         9999-09-09|    9999-09-09 09:09:...|         9999-09-09|    9999-09-09 09:09:...|      true|         false|              I|       100000|AAAAAAAAAKGIBAAA|            441077|              4582|             8487|               2449763|              2449733|  Mrs.      |Erica               |Parrott          ...|                    Y|         16|            7|        1939|          BELGIUM|   null|Erica.Parrott@9pn...|        2452621   |
|fdb19d3239b45f34c...|  0E-18|


======================================================================================================================================================
FROM SPARK TO SPARK ( USE SPARK TARGETS AS SOURCES)
======================================================================================================================================================

val FromSparkTargetTable = spark.sql("select * from customertable")
FromSparkTargetTable: org.apache.spark.sql.DataFrame = [ziw_row_id: string, ziw_scn: decimal(38,18) ... 29 more fields]

 FromSparkTargetTable.count
res17: Long = 50

FromSparkTargetTable.show()
+--------------------+-------+---------------------+--------------------------+--------------------------+---------------------+-------------------+------------------------+-------------------+------------------------+----------+--------------+---------------+-------------+----------------+------------------+------------------+-----------------+----------------------+---------------------+------------+--------------------+--------------------+-----------+-------------+------------+----------------+-------+--------------------+------------------+---------------------+
|          ziw_row_id|ziw_scn|ziw_source_start_date|ziw_source_start_timestamp|ziw_target_start_timestamp|ziw_target_start_date|ziw_source_end_date|ziw_source_end_timestamp|ziw_target_end_date|ziw_target_end_timestamp|ziw_active|ziw_is_deleted|ziw_status_flag|c_customer_sk|   c_customer_id|c_current_cdemo_sk|c_current_hdemo_sk|c_current_addr_sk|c_first_shipto_date_sk|c_first_sales_date_sk|c_salutation|        c_first_name|         c_last_name|c_birth_day|c_birth_month|c_birth_year| c_birth_country|c_login|     c_email_address|c_last_review_date|c_preferred_cust_flag|
+--------------------+-------+---------------------+--------------------------+--------------------------+---------------------+-------------------+------------------------+-------------------+------------------------+----------+--------------+---------------+-------------+----------------+------------------+------------------+-----------------+----------------------+---------------------+------------+--------------------+--------------------+-----------+-------------+------------+----------------+-------+--------------------+------------------+---------------------+
|fdb19d3239b45f34c...|  0E-18|           2017-10-13|      2017-10-13 06:24:...|      2017-10-13 06:24:...|           2017-10-13|         9999-09-09|    9999-09-09 09:09:...|         9999-09-09|    9999-09-09 09:09:...|      true|         false|              I|        99999|AAAAAAAAPJGIBAAA|           1641963|               292|            15421|               2452000|              2451970|  Mr.       |Rex                 |Reyes            ...|          9|            7|        1981|          GREECE|   null|Rex.Reyes@saLGsYa...|        2452297   |
.
.
.
.

==================
MERGE BUCKETING
============
re information.

scala> val cust = spark.read.option("header", true).option("inferSchema", true).orc("/iw/testmm/input/customer.orc")
cust: org.apache.spark.sql.DataFrame = [ziw_row_id: string, ziw_scn: decimal(38,18) ... 29 more fields]

cust.write.options(Map("path" -> "/iw/testmm/output/customertablebucket")).partitionBy("c_preferred_cust_flag").bucketBy(3,"ziw_row_id").format("orc").saveAsTable("customertablebucket")

> cust.write.options(Map("path" -> "/iw/testmm/output/customertablebucket")).partitionBy("c_preferred_cust_flag").bucketBy(3,"ziw_row_id").format("orc").saveAsTable("customertablebucket")
17/10/25 14:40:21 WARN Utils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.debug.maxToStringFields' in SparkEnv.conf.
17/10/25 14:40:23 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation `customertablebucket` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive. Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customertablebucket

hdfs dfs -ls /iw/testmm/output/customertablebucket/c_preferred_cust_flag=Y
Found 3 items
-rw-r--r--   3 ec2-user hdfs       4777 2017-10-25 14:40 /iw/testmm/output/customertablebucket/c_preferred_cust_flag=Y/part-r-00000-a921b1d8-6602-4598-8e10-f18f8b7c1c5e_00000.snappy.orc
-rw-r--r--   3 ec2-user hdfs       5350 2017-10-25 14:40 /iw/testmm/output/customertablebucket/c_preferred_cust_flag=Y/part-r-00000-a921b1d8-6602-4598-8e10-f18f8b7c1c5e_00001.snappy.orc
-rw-r--r--   3 ec2-user hdfs       5327 2017-10-25 14:40 /iw/testmm/output/customertablebucket/c_preferred_cust_flag=Y/part-r-00000-a921b1d8-6602-4598-8e10-f18f8b7c1c5e_00002.snappy.orc
[ec2-user@dev2 ~]$



=============

SPARK READING PARTITIONS

==========================

val par1 = spark.read.option("inferSchema", true).orc("/iw/testmm/output/customer/c_preferred_cust_flag=N/*");
par1: org.apache.spark.sql.DataFrame = [ziw_row_id: string, ziw_scn: decimal(38,18) ... 28 more fields]


scala> par1.count()
17/10/26 07:12:10 WARN Utils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.debug.maxToStringFields' in SparkEnv.conf.
res2: Long = 27


//create multiple partitioned table 
val cust = spark.read.option("header", true).option("inferSchema", true).orc("/iw/testmm/input/customer.orc")

cust.write.options(Map("path" -> "/iw/testmm/output/customermulpar")).partitionBy("c_preferred_cust_flag","c_salutation").format("orc").saveAsTable("customermulpar")
17/10/26 07:15:29 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation `customermulpar` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive. Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customermulpar

scala> spark.sql("select distinct c_salutation , length(c_salutation) from customermulpar").show();

  at org.apache.spark.sql.Dataset.show(Dataset.scala:486)
  at org.apache.spark.sql.Dataset.show(Dataset.scala:495)
  ... 48 elided
Caused by: java.io.FileNotFoundException: File does not exist: hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customermulpar/c_preferred_cust_flag=Y/c_salutation=Sir%20%20%20%20%20%20%20/part-r-00000-78066990-4647-4895-b033-5368a1949cae.snappy.orc
It is possible the underlying files have been updated. You can explicitly invalidate the cache in Spark by running 'REFRESH TABLE tableName' command in SQL or by recreating the Dataset/DataFrame involved.


cust.write.options(Map("path" -> "/iw/testmm/output/customermulpar2")).partitionBy("c_preferred_cust_flag","c_birth_year").format("orc").saveAsTable("customermulpar2")
17/10/26 07:48:50 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation `customermulpar2` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive. Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customermulpar2

a> spark.sql("select count(*) from customermulpar2").show();
+--------+
|count(1)|
+--------+
|      50|
+--------+


scala> spark.sql("select distinct length(c_salutation) from customermulpar2").show();
+--------------------+
|length(c_salutation)|
+--------------------+
|                  10|
+--------------------+


try if recursive reading works

hdfs dfs -ls /iw/testmm/output/customermulpar2/c_preferred_cust_flag=Y/
Found 20 items
drwxr-xr-x   - ec2-user hdfs          0 2017-10-26 07:48 /iw/testmm/output/customermulpar2/c_preferred_cust_flag=Y/c_birth_year=1925
drwxr-xr-x   - ec2-user hdfs          0 2017-10-26 07:48 /iw/testmm/output/customermulpar2/c_preferred_cust_flag=Y/c_birth_year=1926
drwxr-xr-x   - ec2-user hdfs          0 2017-10-26 07:48 /iw/testmm/output/customermulpar2/c_preferred_cust_flag=Y/c_birth_year=1932
 etc

 val prefY = spark.read.option("inferSchema", true).orc("/iw/testmm/output/customermulpar2/c_preferred_cust_flag=N/*");


scala> prefY.take(3)
res20: Array[org.apache.spark.sql.Row] = Array([6cffc259c5f8b882368c5b9ed4fbf85e,0E-18,2017-10-13,2017-10-13 06:24:57.0,2017-10-13 06:24:20.0,2017-10-13,9999-09-09,9999-09-09 09:09:09.0,9999-09-09,9999-09-09 09:09:09.0,true,false,I,99998,AAAAAAAAOJGIBAAA,1030893,4338,46583,2452285,2452255,Dr.       ,Helen               ,Bateman                       ,8,11,UNITED KINGDOM,null,Helen.Bateman@bVJ4ND7frLIIJZX.org                 ,2452541   ], [f23cddf3ca13475eec9593f101f9ae59,0E-18,2017-10-13,2017-10-13 06:24:57.0,2017-10-13 06:24:20.0,2017-10-13,9999-09-09,9999-09-09 09:09:09.0,9999-09-09,9999-09-09 09:09:09.0,true,false,I,99976,AAAAAAAAIIGIBAAA,906755,1337,48672,2450687,2450657,Dr.       ,Robert              ,Butler                        ,16,9,ESTONIA,null,Robert.Butler@e7AfLSPXFeZ.org   ...
scala>


===================
SPACE ISSUE
===============

cust.write.options(Map("path" -> "/iw/testmm/output/customerspaceissue")).partitionBy("c_salutation").format("orc").saveAsTable("customerspaceissue")
17/10/26 07:51:08 WARN CreateDataSourceTableUtils: Persisting partitioned data source relation `customerspaceissue` into Hive metastore in Spark SQL specific format, which is NOT compatible with Hive. Input path(s):
hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customerspaceissue


spark.sql("select distinct length(c_salutation) from customerspaceissue").show();

spark.sql("select distinct length(c_salutation) from customerspaceissue").show();
17/10/26 07:51:31 WARN TaskMemoryManager: leak 256.0 KB memory from org.apache.spark.unsafe.map.BytesToBytesMap@1fdb7b2d
17/10/26 07:51:31 WARN TaskMemoryManager: leak a page: org.apache.spark.unsafe.memory.MemoryBlock@39262473 in task 548
17/10/26 07:51:31 ERROR Executor: Exception in task 0.0 in stage 23.0 (TID 548)
java.io.FileNotFoundException: File does not exist: hdfs://ip-172-30-1-247.ec2.internal:8020/iw/testmm/output/customerspaceissue/c_salutation=Dr.%20%20%20%20%20%20%20/part-r-00000-d743f493-e94b-4cff-97d7-9b1dd4096a47.snappy.orc